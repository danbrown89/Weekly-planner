<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Weekly Planner — Mon–Fri</title>
<style>
  :root{
    --bg:#0f1115;
    --panel:#171a21;
    --muted:#8b93a7;
    --text:#e8ecf1;
    --accent:#4da3ff;
    --border:#2a3040;
    --card:#1f2430;
  }
  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background: var(--bg); color: var(--text); }
  header{ position: sticky; top:0; z-index: 5; background: linear-gradient(180deg, rgba(15,17,21,.95), rgba(15,17,21,.85)); backdrop-filter: blur(6px); border-bottom: 1px solid var(--border); }
  .toolbar{ max-width: 1200px; margin: 0 auto; padding: 12px 16px; display: grid; grid-template-columns: 1fr auto auto auto auto; gap: 8px; align-items: center; }
  .title{ display:flex; align-items:center; gap:10px; font-weight:600; }
  .title .week-label{ font-size: 1.05rem; }
  .btn{ appearance: none; border: 1px solid var(--border); border-radius: 8px; padding: 8px 12px; background: var(--panel); color: var(--text); cursor: pointer; font-weight: 600; }
  .btn:hover{ border-color: var(--accent); }
  .btn.secondary{ background: transparent; }
  .btn.icon{ width: 36px; padding: 8px 0; text-align:center; }
  .btn.small{ padding: 4px 8px; font-size: .9rem; }
  .wrapper{ max-width: 1200px; margin: 12px auto 32px; padding: 0 12px 24px; }
  .grid{ border: 1px solid var(--border); border-radius: 10px; overflow: hidden; }
  .grid-header, .row{ display: grid; grid-template-columns: 160px repeat(5, 1fr); }
  .grid-header > div{ background: var(--panel); border-bottom: 1px solid var(--border); padding: 10px 12px; font-weight: 700; text-align: center; position: sticky; top: 56px; z-index: 4; }
  .grid-header > div:first-child{ text-align:left; position: sticky; left: 0; z-index: 6; }
  .row > div{ min-height: 120px; border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); padding: 8px; overflow: hidden; position: relative; }
  .row > div:first-child{ background: var(--panel); font-weight: 600; position: sticky; left:0; z-index: 3; display:flex; align-items:center; justify-content:space-between; gap:8px; }
  .name-tag{ white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }
  .add-btn{ border:1px dashed var(--border); background: transparent; color: var(--muted); border-radius: 6px; padding: 2px 6px; cursor: pointer; }
  .cell{ background: rgba(255,255,255,0.01); }
  .cell.drop-hover{ outline: 2px dashed var(--accent); outline-offset: -4px; }
  .task{ background: var(--card); border:1px solid var(--border); border-radius: 8px; padding: 6px 8px; margin-bottom: 6px; user-select:none; }
  .task .meta{ font-size:.75rem; color: var(--muted); }
  .task .actions{ position:absolute; right:6px; top:6px; display:none; gap:6px; }
  .task:hover .actions{ display:flex; }
  .muted{ color: var(--muted); }
  .footer{ color: var(--muted); font-size: .9rem; margin-top: 10px; display:flex; gap:12px; align-items:center; flex-wrap: wrap; }
  .sr-only{ position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden;}
  @media (pointer: coarse){ .task .actions{ display:flex; } } /* always show actions on touch */
  @media (max-width: 800px){ .grid-header, .row{ grid-template-columns: 120px repeat(5, 1fr); } .row > div{ min-height: 100px; } }
</style>
</head>
<body>
<header>
  <div class="toolbar">
    <div class="title">
      <button class="btn icon" id="prevBtn" title="Previous week" aria-label="Previous week">&#x25C0;</button>
      <button class="btn icon" id="todayBtn" title="Jump to this week" aria-label="This week">●</button>
      <button class="btn icon" id="nextBtn" title="Next week" aria-label="Next week">&#x25B6;</button>
      <div class="week-label" id="weekLabel"></div>
    </div>
    <button class="btn secondary" id="exportBtn" title="Export this week as JSON">Export</button>
    <label class="btn secondary" for="importFile" title="Import a previously exported week">Import</label>
    <input id="importFile" type="file" accept="application/json" class="sr-only" />
    <button class="btn secondary" id="clearBtn" title="Clear all tasks for this week">Clear</button>
    <button class="btn" id="namesBtn" title="Edit names">Edit names</button>
  </div>
</header>

<div class="wrapper">
  <div class="grid" id="grid"></div>
  <div class="footer">
    <span>Tip: double-tap a cell to add a task. Tap a task’s <em>Move</em> to place it elsewhere (mobile-friendly).</span>
  </div>
</div>

<template id="taskTemplate">
  <div class="task">
    <div class="text"></div>
    <div class="meta"></div>
    <div class="actions">
      <button class="btn small secondary move">Move</button>
      <button class="btn small secondary edit">Edit</button>
      <button class="btn small secondary del">Delete</button>
    </div>
  </div>
</template>

<script>
(function(){
  const WORKWEEK_DAYS = 5; // Mon–Fri
  const grid = document.getElementById('grid');
  const weekLabel = document.getElementById('weekLabel');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const todayBtn = document.getElementById('todayBtn');
  const exportBtn = document.getElementById('exportBtn');
  const importFile = document.getElementById('importFile');
  const clearBtn = document.getElementById('clearBtn');
  const namesBtn = document.getElementById('namesBtn');
  const taskTemplate = document.getElementById('taskTemplate');
  
  const DEFAULT_NAMES = ["Alex","Bailey","Casey","Dakota","Emerson"];
  let names = loadNames();
  let monday = startOfWeek(new Date());

  function startOfWeek(d){
    const c = new Date(d); const day = c.getDay(); // 0 Sun..6 Sat
    const diff = (day === 0 ? -6 : 1 - day);
    c.setHours(0,0,0,0);
    c.setDate(c.getDate() + diff);
    return c;
  }
  function isoDate(d){ return d.toISOString().split('T')[0]; }
  function keyForWeek(d){ return "planner::wk5::"+isoDate(d); }
  function loadWeek(d){
    const raw = localStorage.getItem(keyForWeek(d));
    return raw ? JSON.parse(raw) : {};
  }
  function saveWeek(d, data){
    localStorage.setItem(keyForWeek(d), JSON.stringify(data));
  }
  function loadNames(){
    try{
      const raw = localStorage.getItem("planner::names");
      if(raw){ const arr = JSON.parse(raw); if(Array.isArray(arr) && arr.length) return arr; }
    }catch(e){}
    return DEFAULT_NAMES.slice();
  }
  function saveNames(){ localStorage.setItem("planner::names", JSON.stringify(names)); }

  function formatRangeLabel(monday){
    const friday = new Date(monday); friday.setDate(friday.getDate()+4);
    const opts = { month:'short', day:'numeric' };
    const y = friday.getFullYear();
    return `${monday.toLocaleDateString(undefined, opts)} – ${friday.toLocaleDateString(undefined, opts)}, ${y}`;
  }

  function render(){
    grid.innerHTML = '';
    const header = document.createElement('div');
    header.className = 'grid-header';
    const corner = document.createElement('div');
    corner.textContent = "People";
    header.appendChild(corner);
    for(let i=0;i<WORKWEEK_DAYS;i++){
      const d = new Date(monday); d.setDate(monday.getDate()+i);
      const h = document.createElement('div');
      h.innerHTML = `<div>${d.toLocaleDateString(undefined,{weekday:'short'})}</div>
                     <div class="muted">${d.toLocaleDateString(undefined,{month:'short',day:'numeric'})}</div>`;
      header.appendChild(h);
    }
    grid.appendChild(header);

    // rows
    const weekData = loadWeek(monday);
    names.forEach((name, rowIdx)=>{
      const row = document.createElement('div');
      row.className = 'row';
      const nameCell = document.createElement('div');
      nameCell.innerHTML = `<span class="name-tag">${name}</span> <button class="add-btn" title="Add task">＋</button>`;
      const addBtn = nameCell.querySelector('button');
      addBtn.addEventListener('click', ()=> promptAdd(rowIdx, currentDayIndex()));
      row.appendChild(nameCell);
      for(let i=0;i<WORKWEEK_DAYS;i++){
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.row = rowIdx;
        cell.dataset.day = i;
        cell.addEventListener('dblclick', ()=> promptAdd(rowIdx, i));
        row.appendChild(cell);
      }
      grid.appendChild(row);
    });

    // populate tasks
    Object.entries(weekData).forEach(([k, tasks])=>{
      tasks.forEach(t=> addTaskElement(t));
    });

    // label
    weekLabel.textContent = `Week of ${formatRangeLabel(monday)}`;
  }

  function currentDayIndex(){
    const today = new Date();
    const diff = Math.floor((today - monday)/86400000);
    return (diff >=0 && diff < WORKWEEK_DAYS) ? diff : 0;
  }

  function promptAdd(row, day){
    const text = prompt("Task / note");
    if(!text) return;
    const t = { id: crypto.randomUUID(), text, row, day };
    const data = loadWeek(monday);
    const key = `${row}:${day}`;
    data[key] = data[key] || [];
    data[key].push(t);
    saveWeek(monday, data);
    addTaskElement(t);
  }

  function addTaskElement(t){
    const cell = grid.querySelector(`.cell[data-row="${t.row}"][data-day="${t.day}"]`);
    if(!cell) return;
    const clone = taskTemplate.content.firstElementChild.cloneNode(true);
    clone.dataset.id = t.id;
    clone.querySelector('.text').textContent = t.text;
    clone.querySelector('.meta').textContent = names[t.row];
    clone.querySelector('.del').addEventListener('click', ()=> removeTask(t.id));
    clone.querySelector('.edit').addEventListener('click', ()=> editTask(t.id));
    clone.querySelector('.move').addEventListener('click', ()=> moveTaskDialog(t.id));
    cell.appendChild(clone);
  }

  function getAllTasks(){
    const data = loadWeek(monday);
    return Object.values(data).flat();
  }

  function removeTask(id){
    const data = loadWeek(monday);
    for(const key of Object.keys(data)){
      data[key] = data[key].filter(t=> t.id !== id);
      if(!data[key].length) delete data[key];
    }
    saveWeek(monday, data);
    const el = grid.querySelector(`.task[data-id="${id}"]`);
    if(el) el.remove();
  }

  function editTask(id){
    const data = loadWeek(monday);
    for(const key of Object.keys(data)){
      const idx = data[key].findIndex(t=> t.id === id);
      if(idx >= 0){
        const t = data[key][idx];
        const newText = prompt("Edit text", t.text);
        if(newText){
          t.text = newText;
          saveWeek(monday, data);
          const el = grid.querySelector(`.task[data-id="${id}"] .text`);
          if(el) el.textContent = newText;
        }
        return;
      }
    }
  }

  function moveTaskDialog(id){
    const data = loadWeek(monday);
    for(const key of Object.keys(data)){
      const idx = data[key].findIndex(t=> t.id === id);
      if(idx >= 0){
        const t = data[key][idx];
        const nameOptions = names.map((n,i)=> `${i}:${n}`).join(', ');
        const newRow = prompt(`Move to person (index:name): ${nameOptions}`, String(t.row));
        if(newRow === null) return;
        const r = Math.max(0, Math.min(names.length-1, parseInt(newRow,10)||0));
        const dayOptions = ["Mon","Tue","Wed","Thu","Fri"].map((d,i)=> `${i}:${d}`).join(', ');
        const newDay = prompt(`Move to day (index:day): ${dayOptions}`, String(t.day));
        if(newDay === null) return;
        const d = Math.max(0, Math.min(WORKWEEK_DAYS-1, parseInt(newDay,10)||0));
        moveTaskToCell(id, r, d);
        return;
      }
    }
  }

  function moveTaskToCell(id, newRow, newDay){
    const data = loadWeek(monday);
    for(const key of Object.keys(data)){
      const idx = data[key].findIndex(t=> t.id === id);
      if(idx >= 0){
        const t = data[key][idx];
        // remove from old
        data[key].splice(idx,1);
        if(!data[key].length) delete data[key];
        // add to new
        const newKey = `${newRow}:${newDay}`;
        t.row = newRow; t.day = newDay;
        data[newKey] = data[newKey] || [];
        data[newKey].push(t);
        saveWeek(monday, data);
        // move DOM
        const dest = grid.querySelector(`.cell[data-row="${newRow}"][data-day="${newDay}"]`);
        const el = grid.querySelector(`.task[data-id="${id}"]`);
        if(dest && el){ dest.appendChild(el); el.querySelector('.meta').textContent = names[newRow]; }
        return;
      }
    }
  }

  // Navigation
  prevBtn.addEventListener('click', ()=>{ monday.setDate(monday.getDate()-7); render(); });
  nextBtn.addEventListener('click', ()=>{ monday.setDate(monday.getDate()+7); render(); });
  todayBtn.addEventListener('click', ()=>{ monday = startOfWeek(new Date()); render(); });

  // Export / Import / Clear
  exportBtn.addEventListener('click', ()=>{
    const data = loadWeek(monday);
    const blob = new Blob([JSON.stringify({ weekStart: isoDate(monday), names, data }, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `weekly-planner-mon-fri-${isoDate(monday)}.json`;
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  });
  importFile.addEventListener('change', async (e)=>{
    const file = e.target.files[0]; if(!file) return;
    const text = await file.text();
    try{
      const obj = JSON.parse(text);
      if(obj.names && Array.isArray(obj.names)) { names = obj.names; saveNames(); }
      if(obj.weekStart && obj.data){
        monday = startOfWeek(new Date(obj.weekStart));
        saveWeek(monday, obj.data);
        render();
      } else { alert("Invalid file format."); }
    }catch(err){ alert("Could not import file."); }
    e.target.value = "";
  });
  clearBtn.addEventListener('click', ()=>{
    if(confirm("Clear all tasks for this week?")){
      localStorage.removeItem(keyForWeek(monday));
      render();
    }
  });

  // Edit names
  namesBtn.addEventListener('click', ()=> openNamesEditor());

  function openNamesEditor(){
    const overlay = document.createElement('div');
    Object.assign(overlay.style,{
      position:'fixed', inset:0, background:'rgba(0,0,0,.6)', zIndex:10, display:'grid', placeItems:'center'
    });
    const panel = document.createElement('div');
    Object.assign(panel.style,{
      background:'var(--panel)', border:'1px solid var(--border)', borderRadius:'12px',
      padding:'16px', width:'min(520px, 92vw)', color:'var(--text)'
    });
    panel.innerHTML = `<h3 style="margin-top:0">Edit names</h3>
      <div id="editor"></div>
      <div style="display:flex; gap:8px; margin-top: 12px; justify-content:flex-end">
        <button class="btn secondary" id="addName">Add</button>
        <button class="btn secondary" id="resetNames">Reset</button>
        <button class="btn" id="saveNames">Save</button>
      </div>`;
    overlay.appendChild(panel);
    document.body.appendChild(overlay);
    const editor = panel.querySelector('#editor');
    function build(){
      editor.innerHTML = '';
      names.forEach((n,i)=>{
        const row = document.createElement('div');
        row.style.display = 'flex'; row.style.gap = '6px'; row.style.marginBottom='6px';
        row.innerHTML = `<input value="${n}" data-i="${i}" style="flex:1; padding:6px; border-radius:8px; border:1px solid var(--border); background: var(--bg); color:var(--text)"/>
                         <button class="btn small secondary" data-del="${i}">Remove</button>`;
        editor.appendChild(row);
      });
    }
    build();
    editor.addEventListener('input', (e)=>{
      if(e.target.matches('input[data-i]')){
        const i = Number(e.target.dataset.i);
        names[i] = e.target.value;
      }
    });
    editor.addEventListener('click', (e)=>{
      if(e.target.dataset.del){
        const i = Number(e.target.dataset.del);
        names.splice(i,1); build();
      }
    });
    panel.querySelector('#addName').addEventListener('click', ()=>{ names.push('New person'); build(); });
    panel.querySelector('#resetNames').addEventListener('click', ()=>{ names = DEFAULT_NAMES.slice(); build(); });
    panel.querySelector('#saveNames').addEventListener('click', ()=>{ saveNames(); render(); document.body.removeChild(overlay); });
    overlay.addEventListener('click', (e)=>{ if(e.target === overlay) document.body.removeChild(overlay); });
  }

  // init
  render();
})(); 
</script>
</body>
</html>
